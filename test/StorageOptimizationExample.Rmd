Using convex continuous piecewise linear function for the optimization of storage 
========================================================

First let us load the package 
```{r,message=FALSE}
library(ConConPiWiFun)
```


Now we create the cost functions $C_i$ $i=1,\dots,n$. These are 
```{r,message=FALSE}
CCPWLfuncList=new(cplfunctionvec) 
n=1000; Y=rnorm(n); 
S1=array(-1,n); S2=array(1,n); ## increasing slopes -1, 1 for all C_i i=1,..,n
B0=array(-Inf,n); B1=rnorm(n); ## increasing breakpoints -Inf, N(0,1) for all C_i i=1,..,n
CCPWLfuncList$SerialPush_2Breaks_Functions(S1,S2,B0,B1);
```
Then, we define the constraints on storage (capacity and power constraints)
```{r,message=FALSE}
Pmoins=array(-1,n);Pplus=array(1,n);Cmoins=array(0,n);Cplus=array(5,n);
```

and perform the optimization: 
```{r,message=FALSE}
res=CCPWLfuncList$OptimMargInt(Pmoins,Pplus,Cmoins,Cplus)
```

```{r fig.width=7, fig.height=6, echo=FALSE}
par(mfrow=c(1,2))
plot(Y,type='l')
lines(y=Pmoins,x=1:n,col='blue'); lines(y=Pplus,x=1:n,col='blue');
lines(y=res$xEtoile,x=1:n,col='red')
text(x=800,y=3,paste("Optimum=",signif(sum(abs(res$xEtoile-Y)),digits=6)))
plot(Y,type='l',ylim=c(min(Y),max(diffinv(res$xEtoile)[1:n+1])))
lines(y=Cmoins,x=1:n,col='blue'); lines(y=Cplus,x=1:n,col='blue');
lines(y=diffinv(res$xEtoile)[1:n+1],x=1:n,col='red')
```

